#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "listad.h"
#include <unistd.h>

typedef struct {
    int dinheiros;
} Jogador;
//acho q n precisa, na real


void loja(Jogador *j, int *qpokebola, int *qpocao, int *qrevive) {
    int opcao;
    #ifdef _WIN32
	system("cls");
#else
	system("clear");
#endif
    printf("%d pokebolas, %d poções, %d revives\n\n", *qpokebola, *qpocao, *qrevive);
    printf("Bem-vindo à loja! Você tem %d dinheiros.\n", j->dinheiros);
    printf("1. Comprar poção (300 dinheiros)\n");
    printf("2. Comprar pokébola (300 dinheiros)\n");
    printf("3. Comprar revive (500 dinheiros)\n");
    printf("4. Sair da loja\n");

    scanf("%d", &opcao);

    switch(opcao) {
        case 1:
            if (j->dinheiros >= 300) {
                j->dinheiros -= 300;
                printf("Você comprou uma poção!\n\n");
                (*qpocao)++;
                sleep(3);
            } else {
                printf("Moedas insuficientes!\n\n");
                sleep(3);
            }
            break;
        case 2:
            if (j->dinheiros >= 300) {
                j->dinheiros -= 300;
                printf("Você comprou uma pokébola!\n\n");
                (*qpokebola)++;
                sleep(3);
            } else {
                printf("Moedas insuficientes!\n\n");
                sleep(3);
            }
            break;
        case 3:
            if (j->dinheiros >= 500) {
                j->dinheiros -= 500;
                printf("Você comprou um revive!\n\n");
                (*qrevive)++;
                sleep(3);
            } else {
                printf("Moedas insuficientes!\n\n");
                sleep(3);
            }
            break;
        case 4:
            printf("Saindo da loja\n\n");
            sleep(3);
            break;
        default:
            printf("Opção inválida!\n\n");
            sleep(3);
    }
    if(opcao!=4){
        loja(j, qpokebola, qpocao, qrevive);
    }
}

void crialistaloja(tp_listad **l) {
    *l = inicializa_listad();
    char pocao[10] = "poção";
    char pokebola[10] = "pokebola";
    char revive[10] = "revive";
    
    insere_listad_no_fim(*l, revive);
    insere_listad_no_fim(*l, pocao);
    insere_listad_no_fim(*l, pokebola);

    (*l)->fim->prox = (*l)->ini;
    (*l)->ini->ant = (*l)->fim;
    //imprime_listad(*l, 1);
    //a lista tá certa
}

tp_listad * imprimelistalootbox(Jogador *j, tp_listad *atu, int *qpokebola, int *qpocao, int *qrevive) {
    int item;
    char * item_lootbox;
     #ifdef _WIN32
	system("cls");
#else
	system("clear");
#endif
    printf("%d pokebolas, %d poções, %d revives\n\n", *qpokebola, *qpocao, *qrevive);
    printf("Escolha um item da Lootbox:\n");
    
    for (int i = 0; i < 2; i++) { 
        atu->ini = atu->ini->prox;
        printf("%d. %s\n",i+1, atu->ini->info/*tá dando lixo*/);
    }
    scanf("%d", &item);
    if(item==2){
        item_lootbox = atu->ini->info;
        printf("Você adquiriu um(a) %s!\n\n", item_lootbox);
        
        if (strcmp(atu->ini->info, "poção") == 0){
            (*qpocao)++;
        }
        else if (strcmp(atu->ini->info, "pokebola") == 0){
            (*qpokebola)++;
        }
        else if (strcmp(atu->ini->info, "revive") == 0){ 
            (*qrevive)++;
        }
    }
    else if(item==1){
        item_lootbox = atu->ini->ant->info;
        printf("Você adquiriu um(a) %s!\n\n", item_lootbox);
        
        if (strcmp(atu->ini->ant->info, "poção") == 0){
            (*qpocao)++;
        }
        else if (strcmp(atu->ini->ant->info, "pokebola") == 0){
            (*qpokebola)++;
        }
        else if (strcmp(atu->ini->ant->info, "revive") == 0){ 
            (*qrevive)++;
        }
    }
    loja(j, qpokebola, qpocao, qrevive);
    
    #ifdef _WIN32
	system("cls");
#else
	system("clear");
#endif
    
    return atu;
    
    
}

int main() {
    Jogador j;
    j.dinheiros = 1000;
    int qpokebola = 5, qpocao = 0, qrevive = 0;
    
    tp_listad *l;
    tp_listad *atu;
    
    crialistaloja(&l);
    atu=l;
    
    char *item_lootbox; //aponta para oq o usuario escolhe na lootbox
    
    
    
    
    //atu=imprimelistalootbox(&j ,atu, &qpokebola, &qpocao, &qrevive);
    
    
    
    //seria bom colocar a quantidade de cada coisa antes
    
    
    atu=imprimelistalootbox(&j ,atu, &qpokebola, &qpocao, &qrevive);
    atu=imprimelistalootbox(&j ,atu, &qpokebola, &qpocao, &qrevive);
    
    
    //tb tentei jogar isso pra uma função separada, mas fui incapaz :(
    
    return 0;
}
